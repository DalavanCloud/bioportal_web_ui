<%@title = "Submit new ontology" %>
<script src="/javascripts/ui.core.js" type="text/javascript" charset="utf-8">
</script>
<script src="/javascripts/ui.datepicker.js" type="text/javascript" charset="utf-8">
</script>
<link rel="stylesheet" href="/stylesheets/layout/ui.core.css" type="text/css" media="screen" title="no title" charset="utf-8">
<link rel="stylesheet" href="/stylesheets/layout/ui.datepicker.css" type="text/css" media="screen" title="no title" charset="utf-8">
<link rel="stylesheet" href="/stylesheets/layout/ui.theme.css" type="text/css" media="screen" title="no title" charset="utf-8">
<script type="text/javascript">
    $(function(){
        $("#datepicker").datepicker({
            showOn: 'button',
            buttonImage: '/images/calendar.gif',
            buttonImageOnly: true
        });
    });
    
</script>
<script type="text/javascript">
    // Used to provide default text in fields
    jQuery(document).ready(function(){
        jQuery(".defaultText").each(function(){
            if ($(this).val() == this.title) {
                jQuery(this).addClass("defaultTextActive");
                jQuery(this).val(jQuery(this)[0].title);
            }
            else {
                jQuery(this).removeClass("defaultTextActive");
            }
        });
        
        jQuery(".defaultText").focus(function(srcc){
            if ($(this).val() == $(this)[0].title) {
                $(this).removeClass("defaultTextActive");
                $(this).val("");
            }
        });
        
        jQuery(".defaultText").blur(function(){
            if ($(this).val() == "") {
                $(this).addClass("defaultTextActive");
                $(this).val($(this)[0].title);
            }
        });
        
        jQuery(".defaultText").blur();
    });
    
    jQuery("form").submit(function(){
        jQuery(".defaultText").each(function(){
            if ($(this).val() == this.title) {
                $(this).val("");
            }
        });
    });
</script>
<script type="text/javascript">
    // Handles showing/hiding options for a particular ontology format
    jQuery(document).ready(function(){
        jQuery("#ontology_format").change(ontologyFormatChange);
        
        // Check to see if owl is selected, show options if so
        ontologyFormatChange();
    });
    
    function ontologyFormatChange(format){
        var selected = jQuery("#ontology_format option:selected");

		switch(selected.val()){
			case 'OWL':
			case 'OWL-DL':
			case 'OWL-FULL':
			case 'OWL-LITE':
				jQuery(".format_options").optionsOut("fast");				
				jQuery("#owl_options").optionsIn("fast");
				break;
			case 'RRF':
				jQuery(".format_options").optionsOut("fast");				
				jQuery("#rrf_options").optionsIn("fast");
				break;
			default:
				jQuery(".format_options").optionsOut("fast");				
		}
    }
    
    jQuery.fn.optionsIn = function(speed, easing, callback){
        jQuery("#format_spacing").css("margin", "1em 0");
        this.fadeIn(speed);
    };
    
    jQuery.fn.optionsOut = function(speed, easing, callback){
        this.css("display", "none");
        jQuery("#format_spacing").css("margin", "0");
    };
</script>
<div style="margin:10px;">
    <% form_for(:ontology, :url => ontology_path(@ontology.id), :html => { :method => :put }) do |f| %>
    <%unless @errors.nil? %>
    <div style="color:red;">
        Errors On Form
        <ul>
            <%for error in @errors %>
            <li>
                <%=error %>
            </li>
            <%end %>
        </ul>
    </div>
    <%end %>
    <div style="width:500px">
        <span class="asterik" style="float:right;">* fields are required</span>
        <%if @ontology.ontologyId.nil? %>
        <h1>Edit View Metadata</h1>
        <%else %>
        <h1>Edit View Metadata</h1>
        <%end %>
    </div>
    <%=hidden_field :ontology, :ontologyId %>
    <%=hidden_field :ontology, :viewOnOntologyVersionId %>
    <%=hidden_field :ontology, :userId %>
    <%=hidden_field :ontology, :isView, :value=>1 %>
    <%=hidden_field :ontology, :urn %>
    <style>
        th {
            width: 30%;
        }
        
        textarea {
            width: 400px;
        }
    </style>
    <table class="form" width="90%">
        <tr>
            <th>
                View Name: <span class="asterik">*</span>
            </th>
            <td class="top">
                <%=text_field :ontology, :displayLabel %>
            </td>
        </tr>
        <tr>
            <th>
                View Description: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_area :ontology, :description,:rows=>5 %>
            </td>
        </tr>
        <tr>
            <th>
                View Abbreviation: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_field :ontology, :abbreviation %>
            </td>
        </tr>
		<%if @ontology.format.include?("OWL") || @ontology.format.include?("PROTEGE") %>
	        <tr>
	            <th>
	                Prefered Name Property (Owl Only) (default: <a target="_blank" href="http://www.w3.org/2000/01/rdf-schema#label">rdfs:label</a>)
	            </th>
	            <td>
	                <%=text_field :ontology,:preferredNameSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
	            </td>
	        </tr>
	        <tr>
	            <th>
	                Synonym Property (Owl Only) (default: <a target="_blank" href="http://www.w3.org/2004/02/skos/core#altLabel">skos:altLabel</a>)
	            </th>
	            <td>
	                <%=text_field :ontology,:synonymSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
	            </td>
	        </tr>
	        <tr>
	            <th>
	                Definition Property (Owl Only) (default: <a target="_blank" href="http://www.w3.org/2004/02/skos/core#definition">skos:definition</a>)
	            </th>
	            <td>
	                <%=text_field :ontology,:documentationSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
	            </td>
	        </tr>
	        <tr>
	            <th>
	                Author Property (Owl Only) (default: <a target="_blank" href="http://purl.org/dc/elements/1.1/creator">dc:creator</a>)
	            </th>
	            <td>
	                <%=text_field :ontology,:authorSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
	            </td>
	        </tr>
        <%end %>
		
		<% if @ontology.format.include?("RRF") %>
	        <tr>
	            <th>
	                Target Terminologies (RRF Only)
	            </th>
	            <td>
	                <%=text_field :ontology,:targetTerminologies, :title => 'Target Terminologies' %>
	            </td>
	        </tr>
		<% end %>

        <tr>
            <th>
                View Version: <span class="asterik">*</span>
            </th>
            <td>
                <%=text_field :ontology, :versionNumber %>
            </td>
        </tr>
        <tr>
            <th>
                Date Released: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_field :ontology, :dateReleased,:id=>"datepicker" %>
            </td>
        </tr>
        <tr>
            <th>
                Categories:
                <br/>
                (use Ctrl or Cmd to select more than one)
            </th>
            <td>
                <select name="ontology[categoryId][]" multiple="multiple" size="6">
                    <%cats = @categories.values.sort{|a,b| a[:name] <=> b[:name]} %>
                    <%for cat in cats %>
                    <option value="<%=cat[:id]%>"<%if !@ontology.categories.nil? && @ontology.categories.include?(cat[:id]) %>selected<%end %>><%=cat[:name] %></option>
                    <%end %>
                </select>
            </td>
        </tr>
        <tr>
            <th>
                Contact Name:
            </th>
            <td>
                <%=text_field :ontology, :contactName %>
            </td>
        </tr>
        <tr>
            <th>
                Contact Email: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_field :ontology, :contactEmail %>
            </td>
        </tr>
        <tr>
            <th>
                Home Page:
            </th>
            <td>
                <%= text_field :ontology, :homepage %>
            </td>
        </tr>
        <tr>
            <th>
                Documentation Page:
            </th>
            <td>
                <%= text_field :ontology, :documentation %>
            </td>
        </tr>
        <tr>
            <th>
                Publications Page:
            </th>
            <td>
                <%= text_field :ontology, :publication %>
            </td>
        </tr>
        <tr>
            <th>
                View Definition:
            </th>
            <td>
                <%=text_area :ontology, :viewDefinition %>
            </td>
        </tr>
        <tr>
            <th>
                View Definition Language:
            </th>
            <td>
                <% languages = [ "Manual", "ARQ", "RDQL", "RQL", "RVL", "SPARQL", "vSPARQL" ] %>
                <%= select("ontology", "viewDefinitionLanguage", languages, { :include_blank => false, :selected => @ontology.viewDefinitionLanguage }, { :style => "width: 100px;" }) %>
            </td>
        </tr>
        <tr>
            <th>
                View Generation Engine:
            </th>
            <td>
                <% engines = [ "Jena/ARQ", "Pellet", "Redland/Rasqal", "Sesame/SPARQL Engine", "Virtuoso SPARQL" ] %>
                <%= select("ontology", "viewGenerationEngine", engines, { :include_blank => false, :selected => @ontology.viewGenerationEngine }, { :style => "width: 200px;" }) %>
            </td>
        </tr>
        <tr>
            <td colspan="2" align="right">
                <%=submit_tag "Update" %>
            </td>
        </tr>
    </table>
    <%end %>
</div>
