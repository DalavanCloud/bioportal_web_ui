<%@title = "Submit new ontology" %>

<script type="text/javascript">
  jQuery(function(){
      jQuery("#datepicker").datepicker({
          showOn: 'button',
          buttonImage: '/images/calendar.gif',
          buttonImageOnly: true
      });
  });

  // Show/hide location inputs
  function location_toggle(input_div) {
    jQuery('.hidden_field').hide();
    jQuery('.hidden_field input').attr("disabled", true);
    jQuery('#' + input_div + " input").removeAttr("disabled");
    jQuery('#' + input_div).show();
  }
            
</script>
<script type="text/javascript">
    // Used to provide default text in fields
    jQuery(document).ready(function(){
        jQuery(".defaultText").each(function(){
            if ($(this).val() == this.title) {
                jQuery(this).addClass("defaultTextActive");
                jQuery(this).val(jQuery(this)[0].title);
            }
            else {
                jQuery(this).removeClass("defaultTextActive");
            }
        });
        
        jQuery(".defaultText").focus(function(srcc){
            if ($(this).val() == $(this)[0].title) {
                $(this).removeClass("defaultTextActive");
                $(this).val("");
            }
        });
        
        jQuery(".defaultText").blur(function(){
            if ($(this).val() == "") {
                $(this).addClass("defaultTextActive");
                $(this).val($(this)[0].title);
            }
        });
        
        jQuery(".defaultText").blur();
        
        // Properly display the information for 'File Location' based on radio button
        if (jQuery("#ontology_isRemote_0").is(":checked")) {
          location_toggle("upload");
        }

        if (jQuery("#ontology_isRemote_1").is(":checked")) {
          location_toggle("remote");
        }

        // Select default 'File Location' radio button
        if (!jQuery("#ontology_isRemote_0").is(":checked") && !jQuery("#ontology_isRemote_1").is(":checked") && !jQuery("#ontology_isRemote_2").is(":checked")) {
          jQuery("#ontology_isRemote_0").attr("checked", "checked")
        }
    });
    
    jQuery("form").submit(function(){
        jQuery(".defaultText").each(function(){
            if ($(this).val() == this.title) {
                $(this).val("");
            }
        });
    });
</script>
<script type="text/javascript">
    // Handles showing/hiding options for a particular ontology format
    jQuery(document).ready(function(){
        jQuery("#ontology_format").change(ontologyFormatChange);
        
        // Check to see if owl is selected, show options if so
        ontologyFormatChange()
    });
    
    function ontologyFormatChange(format){
        var selected = jQuery("#ontology_format option:selected");

		switch(selected.val()){
			case 'OWL':
			case 'OWL-DL':
			case 'OWL-FULL':
			case 'OWL-LITE':
				jQuery(".format_options").optionsOut("fast");				
				jQuery("#owl_options").optionsIn("fast");
				break;
			case 'RRF':
				jQuery(".format_options").optionsOut("fast");				
				jQuery("#rrf_options").optionsIn("fast");
				break;
			default:
				jQuery(".format_options").optionsOut("fast");				
		}
    }
    
    jQuery.fn.optionsIn = function(speed, easing, callback){
        jQuery("#format_spacing").css("margin", "1em 0");
        this.fadeIn(speed);
    };
    
    jQuery.fn.optionsOut = function(speed, easing, callback){
        this.css("display", "none");
        jQuery("#format_spacing").css("margin", "0");
    };
</script>
<div style="margin:10px;">
    <%form_tag("/ontologies", {:multipart => true, :id => 'new_ontology'}) do %>
    
    <%unless @errors.nil? %>
      <div style="color:red;" class="enable-lists">
          <strong>Errors On Form</strong>
          <ul>
              <%for error in @errors %>
              <li>
                  <%=error %>
              </li>
              <%end %>
          </ul>
      </div>
    <%end %>
    
    <div style="width:500px">
        <span class="asterik" style="float:right;">* fields are required</span>
        <%if @ontology.ontologyId.nil? %>
          <h1>Submit New Ontology</h1>
        <%else %>
          <h1>Submit New Version</h1>
        <%end %>
    </div>
    
    <%=hidden_field :ontology, :ontologyId %>
    <%=hidden_field :ontology, :userId %>
    <table class="form" id="new_ontology" width="90%">
        <tr>
            <th>
                Ontology Name: <span class="asterik">*</span>
            </th>
            <td class="top">
                <%=text_field :ontology, :displayLabel %>
            </td>
        </tr>
        <tr>
            <th>
                Ontology Description: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_area :ontology, :description,:rows=>5 %>
            </td>
        </tr>
        <tr>
            <th>
                Ontology Abbreviation: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_field :ontology, :abbreviation %>
            </td>
        </tr>
        
        <tr>
            <th>
                Ontology Format: <span class="asterik">*</span>
            </th>
            <td>
                <% ont_formats = [ "LEXGRID-XML", "OBO", "OWL", "OWL-DL", "OWL-FULL", "OWL-LITE", "PROTEGE", "RRF" ] %>
                <% selected = @ontology.ontologyId.nil? ? "OWL" : @ontology.format %>
                <%= select("ontology", "format", ont_formats, { :selected => selected, :style => "width: 200px;" }) %>

                <div id="format_spacing">
                </div>
                <table id="format_specific_options">
                    <tbody id="owl_options" class="format_options">
                        <tr>
                            <th>
                                Prefered Name Property
                                <br/><span class="default_owl">default: <a target="_blank" href="http://www.w3.org/2000/01/rdf-schema#label">http://www.w3.org/2000/01/rdf-schema#label</a></span>
                            </th>
                            <td>
                                <%=text_field :ontology, :preferredNameSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Synonym Property
                                <br/><span class="default_owl">default: <a target="_blank" href="http://www.w3.org/2004/02/skos/core#altLabel">http://www.w3.org/2004/02/skos/core#altLabel</a></span>
                            </th>
                            <td>
                                <%=text_field :ontology, :synonymSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Definition Property
                                <br/><span class="default_owl">default: <a target="_blank" href="http://www.w3.org/2004/02/skos/core#definition">http://www.w3.org/2004/02/skos/core#definition</a></span>
                            </th>
                            <td>
                                <%=text_field :ontology, :documentationSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
                            </td>
                        </tr>
                        <tr>
                            <th>
                                Author Property
                                <br/><span class="default_owl">default: <a target="_blank" href="http://purl.org/dc/elements/1.1/creator">http://purl.org/dc/elements/1.1/creator</a></span>
                            </th>
                            <td>
                                <%=text_field :ontology, :authorSlot, :class => 'defaultText defaultTextActive', :title => 'use default' %>
                            </td>
                        </tr>
                    </tbody>
          					<tbody id="rrf_options" class="format_options">
          				        <tr>
          				            <th>
          				                Target Terminologies (RRF Only)
          				            </th>
          				            <td>
          				                <%=text_field :ontology, :targetTerminologies, :title => 'Target Terminologies' %>
          				            </td>
          				        </tr>
          					</tbody>
                </table>
            </td>
        </tr>

        <tr>
            <th>
                Ontology Version:
            </th>
            <td>
                <%=text_field :ontology, :versionNumber %>
            </td>
        </tr>
        <tr>
            <th>
                Status:
            </th>
            <td>
                <% selected_status = @ontology.ontologyId.nil? ? "" : @ontology.versionStatus %>
                <% status_options = ["alpha", "beta", "production", "retired"] %>
                <%= select :ontology, :versionStatus, status_options, { :include_blank => true, :selected => selected_status } %>
            </td>
        </tr>
        <tr>
            <th>
                Ontology Release Date: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_field :ontology, :dateReleased,:id=>"datepicker" %> <span style="font-size: 90%; color: grey;">ex: 05/25/2009</span>
            </td>
        </tr>
        <tr>
            <th>
                Ontology Location <span class="asterik">* </span>
            </th>
            <td id="location_options">
              <%=radio_button :ontology, :isRemote, 0, :onclick=>"location_toggle('upload');" %> Upload Local File
              <br/>
              <span style="font-size:11px;">(choose a file on your local file system to upload)</span>
              <div class="hidden_field" id="upload"<%if @ontology.isRemote.to_i.eql?(1) || @ontology.isRemote.to_i.eql?(3) %>style="display:none;"<%end%>>
                <%=file_field :ontology, :filePath %>
              </div>
              
              <hr/><%=radio_button :ontology, :isRemote, 1, :onclick=>"location_toggle('remote');" %> Load from URL 
              <br/>
              <span style="font-size:11px;">(new versions loaded daily)</span>
              <div class="hidden_field" id="remote"<%if !@ontology.isRemote.to_i.eql?(0) || !@ontology.isRemote.to_i.eql?(3) %>style="display:none;"<%end%>>
                URL: <%=text_field :ontology, :downloadLocation, :size => 100 %>
              </div>
              
              <hr/><%=radio_button :ontology, :isRemote, 3, :onclick=>"$('.hidden_field').hide();" %> Metadata Only 
              <br/>
              <span style="font-size:11px;">(choose this option if you want users to search and view only the <em>metadata</em> for your ontology, but not its classes and properties) </span>
            </td>
        </tr>
        <tr>
            <th>
                Categories:
                <br/>
                (use Ctrl or Cmd to select more than one)
            </th>
            <td>
                <select name="ontology[categoryId][]" multiple="multiple" size="6">
                    <%cats = @categories.values.sort{|a,b| a[:name] <=> b[:name]} %>
                    <%for cat in cats %>
                    <option value="<%=cat[:id]%>"<%if !@ontology.categories.nil? && @ontology.categories.include?(cat[:id]) %>selected<%end %>><%=cat[:name] %></option>
                    <%end %>
                </select>
            </td>
        </tr>
        <tr>
            <th>
                Contact Name:
            </th>
            <td>
                <%=text_field :ontology, :contactName %>
            </td>
        </tr>
        <tr>
            <th>
                Contact Email: <span class="asterik">*</span>
            </th>
            <td>
                <%= text_field :ontology, :contactEmail %>
            </td>
        </tr>
        <tr>
            <th>
                Home Page:
            </th>
            <td>
                <%= text_field :ontology, :homepage %>
            </td>
        </tr>
        <tr>
            <th>
                Documentation Page:
            </th>
            <td>
                <%= text_field :ontology, :documentation %>
            </td>
        </tr>
        <tr>
            <th>
                Publications Page:
            </th>
            <td>
                <%= text_field :ontology, :publication %>
            </td>
        </tr>
        <tr>
            <td colspan="2" align="right">
                <%=submit_tag "Submit" %>
            </td>
        </tr>
    </table>
    <%end %>
</div>
